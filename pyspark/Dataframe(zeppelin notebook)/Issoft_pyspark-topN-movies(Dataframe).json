{"paragraphs":[{"text":"%sh\n\n# if [[-d /tmp/ml-latest]]; then\n#     rm -fr /tmp/ml-latest\n#     echo \"Removed existing folder\"\n# fi\n\nwget -q -O /tmp/ml-latest.zip http://files.grouplens.org/datasets/movielens/ml-latest.zip\necho \"Dowloaded ml-latest.zip ...\"\n\nunzip /tmp/ml-latest.zip -d /tmp/\nrm /tmp/ml-latest.zip\necho \"Unpacked ml-latest.zip ...\"\n\ndir0=/tmp/datalake\ndir1=links\ndir2=movies\ndir3=ratings\ndir4=tags\ndir5=/user/zeppelin/sparkDF/input\n\nfor dir in $dir1 $dir2 $dir3 $dir4;do\n# if [[-d $dir0/$dir]]; then\n#     rm -r $dir0/$dir1\n# fi\n    mkdir -p $dir0/$dir\n    \n    mv /tmp/ml-latest/$dir.csv $dir0/$dir/\n    echo \"Moved $dir.csv to $dir0/$dir/ ...\"\ndone\n\nrm -r /tmp/ml-latest\necho \"Datalake files created!\"\n\nhdfs dfs -mkdir -p $dir5\necho \"Directory $dir5 created in hdfs\"\nhdfs dfs -put -f $dir0/$dir3/$dir3.csv $dir0/$dir2/$dir2.csv $dir5\necho \"Copy $dir3.csv to hdfs://$dir5 complete\"\necho \"Copy $dir2.csv to hdfs://$dir5 complete\"","user":"anonymous","dateUpdated":"2020-03-29T19:32:51+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"sh","editOnDblClick":false,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/sh"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"Dowloaded ml-latest.zip ...\nArchive:  /tmp/ml-latest.zip\n   creating: /tmp/ml-latest/\n  inflating: /tmp/ml-latest/links.csv  \n  inflating: /tmp/ml-latest/tags.csv  \n  inflating: /tmp/ml-latest/genome-tags.csv  \n  inflating: /tmp/ml-latest/ratings.csv  \n  inflating: /tmp/ml-latest/README.txt  \n  inflating: /tmp/ml-latest/genome-scores.csv  \n  inflating: /tmp/ml-latest/movies.csv  \nUnpacked ml-latest.zip ...\nMoved links.csv to /tmp/datalake/links/ ...\nMoved movies.csv to /tmp/datalake/movies/ ...\nMoved ratings.csv to /tmp/datalake/ratings/ ...\nMoved tags.csv to /tmp/datalake/tags/ ...\nDatalake files created!\nDirectory /user/zeppelin/sparkDF/input created in hdfs\nCopy ratings.csv to hdfs:///user/zeppelin/sparkDF/input complete\nCopy movies.csv to hdfs:///user/zeppelin/sparkDF/input complete\n"}]},"apps":[],"jobName":"paragraph_1585400539503_-1754603216","id":"20200328-130219_1734486278","dateCreated":"2020-03-28T13:02:19+0000","dateStarted":"2020-03-29T19:32:51+0000","dateFinished":"2020-03-29T19:33:16+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:3653"},{"text":"%spark.ipyspark\n\n# parametres\n\nN = 5\nmovies_file = \"hdfs:///user/zeppelin/sparkDF/input/movies.csv\"\nratings_file = \"hdfs:///user/zeppelin/sparkDF/input/ratings.csv\"\noutput_dir = \"hdfs:///user/zeppelin/sparkDF/output\"","user":"anonymous","dateUpdated":"2020-03-29T19:33:16+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1585400578169_-1514174400","id":"20200328-130258_1938062273","dateCreated":"2020-03-28T13:02:58+0000","dateStarted":"2020-03-29T19:33:16+0000","dateFinished":"2020-03-29T19:33:26+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3654"},{"text":"%spark.ipyspark\n\n# support functions\n\nfrom functools import reduce\nimport pyspark.sql.functions as func\n\ndef blank_as_null(x):\n    return func.when(func.col(x) != \"\", func.col(x)).otherwise(None)\n","user":"anonymous","dateUpdated":"2020-03-29T19:37:49+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1585407253720_-66694430","id":"20200328-145413_1415079767","dateCreated":"2020-03-28T14:54:13+0000","dateStarted":"2020-03-29T19:37:49+0000","dateFinished":"2020-03-29T19:37:49+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3655"},{"text":"%spark.ipyspark\n\nmovies_df = spark.read.format(\"csv\").options(header=\"true\", inferSchema=\"true\").load(movies_file)\nratings_df = spark.read.format(\"csv\").options(header=\"true\", inferSchema=\"true\").load(ratings_file)","user":"anonymous","dateUpdated":"2020-03-29T19:33:26+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://cluster-6f40-m.us-central1-a.c.issoft-271914.internal:4040/jobs/job?id=0","http://cluster-6f40-m.us-central1-a.c.issoft-271914.internal:4040/jobs/job?id=1","http://cluster-6f40-m.us-central1-a.c.issoft-271914.internal:4040/jobs/job?id=2","http://cluster-6f40-m.us-central1-a.c.issoft-271914.internal:4040/jobs/job?id=3"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1585400885369_964513582","id":"20200328-130805_2029052764","dateCreated":"2020-03-28T13:08:05+0000","dateStarted":"2020-03-29T19:33:26+0000","dateFinished":"2020-03-29T19:34:39+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3656"},{"text":"%spark.ipyspark\n\nmovies_df.show(5)","user":"anonymous","dateUpdated":"2020-03-29T19:44:30+0000","config":{"colWidth":12,"fontSize":9,"enabled":false,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+--------------------+--------------------+\n|movieId|               title|              genres|\n+-------+--------------------+--------------------+\n|      1|    Toy Story (1995)|Adventure|Animati...|\n|      2|      Jumanji (1995)|Adventure|Childre...|\n|      3|Grumpier Old Men ...|      Comedy|Romance|\n|      4|Waiting to Exhale...|Comedy|Drama|Romance|\n|      5|Father of the Bri...|              Comedy|\n+-------+--------------------+--------------------+\nonly showing top 5 rows\n\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://cluster-6f40-m.us-central1-a.c.issoft-271914.internal:4040/jobs/job?id=4"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1585401384238_-714062380","id":"20200328-131624_1318971908","dateCreated":"2020-03-28T13:16:24+0000","dateStarted":"2020-03-29T19:34:39+0000","dateFinished":"2020-03-29T19:34:40+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3657"},{"text":"%spark.ipyspark\n\nratings_df.show(5)","user":"anonymous","dateUpdated":"2020-03-29T19:44:33+0000","config":{"colWidth":12,"fontSize":9,"enabled":false,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+------+-------+------+----------+\n|userId|movieId|rating| timestamp|\n+------+-------+------+----------+\n|     1|    307|   3.5|1256677221|\n|     1|    481|   3.5|1256677456|\n|     1|   1091|   1.5|1256677471|\n|     1|   1257|   4.5|1256677460|\n|     1|   1449|   4.5|1256677264|\n+------+-------+------+----------+\nonly showing top 5 rows\n\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://cluster-6f40-m.us-central1-a.c.issoft-271914.internal:4040/jobs/job?id=5"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1585401386173_2019861790","id":"20200328-131626_856338591","dateCreated":"2020-03-28T13:16:26+0000","dateStarted":"2020-03-29T19:34:40+0000","dateFinished":"2020-03-29T19:34:41+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3658"},{"text":"%spark.ipyspark\n\n\nmovies_normalized_df = movies_df.select(movies_df.movieId,\n                                            func.regexp_extract(movies_df.title, '(.+)[ ]+[(](\\\\d{4})[)]', 1).alias('title'),\n                                            func.regexp_extract(movies_df.title, '(.+)[ ]+[(](\\\\d{4})[)]', 2).alias('year'),\n                                            func.explode(func.split(movies_df.genres, '\\\\|')).alias('genre')\n                                        )\n    \n","user":"anonymous","dateUpdated":"2020-03-29T19:34:41+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1585402583519_1337064869","id":"20200328-133623_2135719765","dateCreated":"2020-03-28T13:36:23+0000","dateStarted":"2020-03-29T19:34:41+0000","dateFinished":"2020-03-29T19:34:41+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3659"},{"text":"%spark.ipyspark\nmovies_normalized_df.show(5)","user":"anonymous","dateUpdated":"2020-03-29T19:44:43+0000","config":{"colWidth":12,"fontSize":9,"enabled":false,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+---------+----+---------+\n|movieId|    title|year|    genre|\n+-------+---------+----+---------+\n|      1|Toy Story|1995|Adventure|\n|      1|Toy Story|1995|Animation|\n|      1|Toy Story|1995| Children|\n|      1|Toy Story|1995|   Comedy|\n|      1|Toy Story|1995|  Fantasy|\n+-------+---------+----+---------+\nonly showing top 5 rows\n\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://cluster-6f40-m.us-central1-a.c.issoft-271914.internal:4040/jobs/job?id=6"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1585402949567_160504051","id":"20200328-134229_322906427","dateCreated":"2020-03-28T13:42:29+0000","dateStarted":"2020-03-29T19:34:41+0000","dateFinished":"2020-03-29T19:34:42+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3660"},{"text":"%spark.ipyspark\n\nratings_normalized_df = ratings_df.groupBy(\"movieId\") \\\n                                  .agg({\"rating\": \"mean\"}) \\\n                                  .withColumnRenamed(\"avg(rating)\", \"rating\")\nratings_normalized_df = ratings_normalized_df.withColumn(\"rating\", func.round(ratings_normalized_df[\"rating\"], 2))","user":"anonymous","dateUpdated":"2020-03-29T19:34:42+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1585402974987_1367541008","id":"20200328-134254_1528256088","dateCreated":"2020-03-28T13:42:54+0000","dateStarted":"2020-03-29T19:34:42+0000","dateFinished":"2020-03-29T19:34:42+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3661"},{"text":"%spark.ipyspark\n\nratings_normalized_df.show(5)","user":"anonymous","dateUpdated":"2020-03-29T19:44:47+0000","config":{"colWidth":12,"fontSize":9,"enabled":false,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+------+\n|movieId|rating|\n+-------+------+\n|  44022|  3.28|\n|  54190|   3.6|\n| 157793|  3.77|\n| 160563|  3.08|\n|   1580|  3.58|\n+-------+------+\nonly showing top 5 rows\n\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://cluster-6f40-m.us-central1-a.c.issoft-271914.internal:4040/jobs/job?id=7"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1585403333894_1064425421","id":"20200328-134853_1931470074","dateCreated":"2020-03-28T13:48:53+0000","dateStarted":"2020-03-29T19:34:49+0000","dateFinished":"2020-03-29T19:35:12+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3662"},{"text":"%spark.ipyspark\n\njoined_df = movies_normalized_df.join(ratings_normalized_df, \"movieId\", \"inner\") \\\n                                .select(\"genre\", \"title\", \"year\", \"rating\")","user":"anonymous","dateUpdated":"2020-03-29T19:35:12+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1585403575736_1902203283","id":"20200328-135255_1994251637","dateCreated":"2020-03-28T13:52:55+0000","dateStarted":"2020-03-29T19:35:12+0000","dateFinished":"2020-03-29T19:35:12+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3663"},{"text":"%spark.ipyspark\n\njoined_df.show(5)","user":"anonymous","dateUpdated":"2020-03-29T19:44:50+0000","config":{"colWidth":12,"fontSize":9,"enabled":false,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---------+--------------------+----+------+\n|    genre|               title|year|rating|\n+---------+--------------------+----+------+\n| Thriller|               Spawn|1997|  2.65|\n|   Sci-Fi|               Spawn|1997|  2.65|\n|Adventure|               Spawn|1997|  2.65|\n|   Action|               Spawn|1997|  2.65|\n| Thriller|The Devil's Advocate|1997|  3.54|\n+---------+--------------------+----+------+\nonly showing top 5 rows\n\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://cluster-6f40-m.us-central1-a.c.issoft-271914.internal:4040/jobs/job?id=8","http://cluster-6f40-m.us-central1-a.c.issoft-271914.internal:4040/jobs/job?id=9"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1585404640614_1220115052","id":"20200328-141040_536444928","dateCreated":"2020-03-28T14:10:40+0000","dateStarted":"2020-03-29T19:35:13+0000","dateFinished":"2020-03-29T19:35:38+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3664"},{"text":"%spark.ipyspark\n\nsorted_df = joined_df.sort(\"genre\", \"rating\", ascending=[1,0])","user":"anonymous","dateUpdated":"2020-03-29T19:35:38+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1585404693910_-412222262","id":"20200328-141133_2025889921","dateCreated":"2020-03-28T14:11:33+0000","dateStarted":"2020-03-29T19:35:38+0000","dateFinished":"2020-03-29T19:35:38+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3665"},{"text":"%spark.ipyspark\n\ncolumns_to_convert = sorted_df.columns[1:3]\n\nfiltered_df = reduce(lambda df, x: df.withColumn(x, blank_as_null(x)), columns_to_convert, sorted_df).dropna()","user":"anonymous","dateUpdated":"2020-03-29T19:37:56+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1585406251797_230316007","id":"20200328-143731_670282212","dateCreated":"2020-03-28T14:37:31+0000","dateStarted":"2020-03-29T19:37:56+0000","dateFinished":"2020-03-29T19:37:56+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3666"},{"text":"%spark.ipyspark\n\nfiltered_df.show(5)","user":"anonymous","dateUpdated":"2020-03-29T19:44:56+0000","config":{"colWidth":12,"fontSize":9,"enabled":false,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+------------------+--------------------+----+------+\n|             genre|               title|year|rating|\n+------------------+--------------------+----+------+\n|(no genres listed)|You Were Meant fo...|1948|   5.0|\n|(no genres listed)|Placebo: Soulmate...|2004|   5.0|\n|(no genres listed)|       Out on a Limb|1987|   5.0|\n|(no genres listed)|             Jacked$|2004|   5.0|\n|(no genres listed)|           Bidder 70|2013|   5.0|\n+------------------+--------------------+----+------+\nonly showing top 5 rows\n\n"}]},"apps":[],"jobName":"paragraph_1585405518130_-1817477720","id":"20200328-142518_106476189","dateCreated":"2020-03-28T14:25:18+0000","dateStarted":"2020-03-29T19:38:01+0000","dateFinished":"2020-03-29T19:38:38+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3667","runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://cluster-6f40-m.us-central1-a.c.issoft-271914.internal:4040/jobs/job?id=10","http://cluster-6f40-m.us-central1-a.c.issoft-271914.internal:4040/jobs/job?id=11"],"interpreterSettingId":"spark"}}},{"text":"%spark.ipyspark\n\nrdd_df = filtered_df.rdd.map(list)\ntop_N_rdd = rdd_df.map(lambda line: (line[0], (line[1], line[2], line[3])))                                            # map to tuple (genre,(title, year, rating))\ntop_N_rdd = top_N_rdd.groupByKey()                                                                                     # group by genre\ntop_N_rdd = top_N_rdd.map(lambda line: (line[0], sorted((list(line[1])), key=lambda line: line[2], reverse=True)))     # map to tuple (genre, [title, year, rating]) for all fims and sort by rating high to low\ntop_N_rdd = top_N_rdd.map(lambda line: (line[0], line[1][0:N]))                                                        # map to tuple (genre, [title, year, rating]) for top N films\ntop_N_rdd = top_N_rdd.flatMap(lambda line: [(line[0], element[0], element[1], element[2]) for element in (line[1])])   # map to tuple (genre, title, year, rating) for top N films\ntop_N_rdd = top_N_rdd.sortBy(lambda line: line)                                                                        # sort by genres","user":"anonymous","dateUpdated":"2020-03-29T19:41:47+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1585405539341_1670967902","id":"20200328-142539_273153556","dateCreated":"2020-03-28T14:25:39+0000","dateStarted":"2020-03-29T19:41:47+0000","dateFinished":"2020-03-29T19:43:05+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3668","runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://cluster-6f40-m.us-central1-a.c.issoft-271914.internal:4040/jobs/job?id=12","http://cluster-6f40-m.us-central1-a.c.issoft-271914.internal:4040/jobs/job?id=13","http://cluster-6f40-m.us-central1-a.c.issoft-271914.internal:4040/jobs/job?id=14","http://cluster-6f40-m.us-central1-a.c.issoft-271914.internal:4040/jobs/job?id=15"],"interpreterSettingId":"spark"}}},{"text":"%spark.ipyspark\n\ntop_N_rdd.take(5)","user":"anonymous","dateUpdated":"2020-03-29T19:45:01+0000","config":{"colWidth":12,"fontSize":9,"enabled":false,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"[('(no genres listed)', 'Bidder 70', '2013', 5.0),\n ('(no genres listed)',\n  \"Evening's Civil Twilight in Empires of Tin\",\n  '2008',\n  5.0),\n ('(no genres listed)', 'Jacked$', '2004', 5.0),\n ('(no genres listed)', 'Out on a Limb', '1987', 5.0),\n ('(no genres listed)',\n  'Placebo: Soulmates Never Die: Live in Paris 2003',\n  '2004',\n  5.0)]"}]},"apps":[],"jobName":"paragraph_1585425256912_-135830448","id":"20200328-195416_1731917289","dateCreated":"2020-03-28T19:54:16+0000","dateStarted":"2020-03-29T19:43:18+0000","dateFinished":"2020-03-29T19:43:23+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3669","runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://cluster-6f40-m.us-central1-a.c.issoft-271914.internal:4040/jobs/job?id=16","http://cluster-6f40-m.us-central1-a.c.issoft-271914.internal:4040/jobs/job?id=17","http://cluster-6f40-m.us-central1-a.c.issoft-271914.internal:4040/jobs/job?id=18"],"interpreterSettingId":"spark"}}},{"text":"%spark.ipyspark\n\ncsv_df = top_N_rdd.toDF().toDF(\"genres\", \"title\", \"year\", \"rating\") \n","user":"anonymous","dateUpdated":"2020-03-29T19:43:23+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1585424914224_-195126632","id":"20200328-194834_2138170752","dateCreated":"2020-03-28T19:48:34+0000","dateStarted":"2020-03-29T19:43:24+0000","dateFinished":"2020-03-29T19:43:26+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3670","runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://cluster-6f40-m.us-central1-a.c.issoft-271914.internal:4040/jobs/job?id=19"],"interpreterSettingId":"spark"}}},{"text":"%spark.ipyspark\n\ncsv_df.take(5)","user":"anonymous","dateUpdated":"2020-03-29T19:45:06+0000","config":{"colWidth":12,"fontSize":9,"enabled":false,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1585509550810_-1011622629","id":"20200329-191910_257261814","dateCreated":"2020-03-29T19:19:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3671","dateFinished":"2020-03-29T19:43:27+0000","dateStarted":"2020-03-29T19:43:26+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"[Row(genres='(no genres listed)', title='Bidder 70', year='2013', rating=5.0),\n Row(genres='(no genres listed)', title=\"Evening's Civil Twilight in Empires of Tin\", year='2008', rating=5.0),\n Row(genres='(no genres listed)', title='Jacked$', year='2004', rating=5.0),\n Row(genres='(no genres listed)', title='Out on a Limb', year='1987', rating=5.0),\n Row(genres='(no genres listed)', title='Placebo: Soulmates Never Die: Live in Paris 2003', year='2004', rating=5.0)]"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://cluster-6f40-m.us-central1-a.c.issoft-271914.internal:4040/jobs/job?id=20","http://cluster-6f40-m.us-central1-a.c.issoft-271914.internal:4040/jobs/job?id=21","http://cluster-6f40-m.us-central1-a.c.issoft-271914.internal:4040/jobs/job?id=22"],"interpreterSettingId":"spark"}}},{"text":"%spark.ipyspark\n\ncsv_df.repartition(1).write.csv(path=output_dir,\n             mode=\"overwrite\", \n             sep=\",\", \n             header=True)\n    # .format('csv') \\\n    # .option('header', 'true') \\\n    # .option('delimiter', ',') \\\n    # .option('encoding', 'utf-8') \\\n    # .option('path', output_dir) \\\n    # .save(\"test\")\n    # .saveAsTable('movies_mapped_and_filtered')","user":"anonymous","dateUpdated":"2020-03-29T19:43:27+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1585409271139_-29173005","id":"20200328-152751_1483401875","dateCreated":"2020-03-28T15:27:51+0000","dateStarted":"2020-03-29T19:43:27+0000","dateFinished":"2020-03-29T19:43:33+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3672","runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://cluster-6f40-m.us-central1-a.c.issoft-271914.internal:4040/jobs/job?id=23"],"interpreterSettingId":"spark"}}},{"text":"%sh\n\n# hdfs dfs -rm -r /user/zeppelin/sparkDF/output","user":"anonymous","dateUpdated":"2020-03-29T19:43:33+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"sh","editOnDblClick":false,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/sh"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1585416955000_888019723","id":"20200328-173555_810828509","dateCreated":"2020-03-28T17:35:55+0000","dateStarted":"2020-03-29T19:43:33+0000","dateFinished":"2020-03-29T19:43:33+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3673"},{"text":"%sh\n\nhdfs dfs -cat /user/zeppelin/sparkDF/output/*0.csv","user":"anonymous","dateUpdated":"2020-03-29T19:45:19+0000","config":{"colWidth":12,"fontSize":9,"enabled":false,"results":{},"editorSetting":{"language":"sh","editOnDblClick":false,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/sh"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"genres,title,year,rating\n(no genres listed),Bidder 70,2013,5.0\n(no genres listed),Evening's Civil Twilight in Empires of Tin,2008,5.0\n(no genres listed),Jacked$,2004,5.0\n(no genres listed),Out on a Limb,1987,5.0\n(no genres listed),Placebo: Soulmates Never Die: Live in Paris 2003,2004,5.0\nAction,Colossus of the Arena,1962,5.0\nAction,In Her Line of Fire,2006,5.0\nAction,Khushi,2001,5.0\nAction,Snakes on a Train,2006,5.0\nAction,The Duel,1981,5.0\nAdventure,Colossus of the Arena,1962,5.0\nAdventure,Hercules Against the Mongols,1963,5.0\nAdventure,I Spy Returns,1994,5.0\nAdventure,Into the Middle of Nowhere,2010,5.0\nAdventure,Temple of the White Elephant,1964,5.0\nAnimation,\"Bagi, the Monster of Mighty Nature (Taishizen no makemono Bagi)\",1984,4.5\nAnimation,Free Jimmy,2006,5.0\nAnimation,Lotte and the Moonstone Secret,2011,5.0\nAnimation,Step Up Love Story (Futari ecchi),2002,4.75\nAnimation,The Story of Anyburg U.S.A.,1957,5.0\nChildren,Aschenputtel,2010,5.0\nChildren,Change of Plans,2011,5.0\nChildren,Dornröschen,2009,5.0\nChildren,Going Attractions: The Definitive Story of the American Drive-in Movie,2013,5.0\nChildren,\"Keeping the Promise (Sign of the Beaver, The)\",1997,5.0\nComedy,Change of Plans,2011,5.0\nComedy,Love Is All,2007,5.0\nComedy,One Night in the Tropics,1940,5.0\nComedy,The Two Firefighters,1968,5.0\nComedy,Twisted Seduction,2010,5.0\nCrime,A Police Inspector Calls,1974,5.0\nCrime,Tempo,2003,5.0\nCrime,The Capture of the Green River Killer,2008,5.0\nCrime,The Duel,1981,5.0\nCrime,The Swindlers,2017,5.0\nDocumentary,Alive Day Memories: Home from Iraq (Occupation Iraq),2007,5.0\nDocumentary,Going Attractions: The Definitive Story of the American Drive-in Movie,2013,5.0\nDocumentary,Great Migrations,2010,5.0\nDocumentary,Unarmed Verses,2017,5.0\nDocumentary,Who Killed Chea Vichea?,2010,5.0\nDrama,A Sister's Revenge,2013,5.0\nDrama,Clearcut,1991,5.0\nDrama,Desirable,1934,5.0\nDrama,The Capture of the Green River Killer,2008,5.0\nDrama,The Hunt for the Unicorn Killer,1999,5.0\nFantasy,Aschenputtel,2010,5.0\nFantasy,Dornröschen,2009,5.0\nFantasy,König Drosselbart,2008,5.0\nFantasy,The Lost Letter,1972,5.0\nFantasy,The Old Fairy Tale: When the Sun Was God,2003,5.0\nFilm-Noir,Double Indemnity,1944,4.2\nFilm-Noir,M,1931,4.16\nFilm-Noir,Notorious,1946,4.16\nFilm-Noir,Sunset Blvd. (a.k.a. Sunset Boulevard),1950,4.2\nFilm-Noir,\"Third Man, The\",1949,4.2\nHorror,Caedes,2015,5.0\nHorror,Dark Asylum,2001,5.0\nHorror,Siccîn,2014,5.0\nHorror,Snakes on a Train,2006,5.0\nHorror,The Wicked,2014,5.0\nIMAX,\"Dark Knight Rises, The\",2012,3.98\nIMAX,\"Dark Knight, The\",2008,4.17\nIMAX,Edge of Tomorrow,2014,3.94\nIMAX,Inception,2010,4.16\nIMAX,Interstellar,2014,4.09\nMusical,\"Chocolate Soldier, The\",1941,4.5\nMusical,Comin' Round the Mountain,1951,5.0\nMusical,Latin Music USA,2009,5.0\nMusical,Let the Good Times Roll,1973,4.5\nMusical,Listen Darling,1938,4.75\nMystery,A Sister's Revenge,2013,5.0\nMystery,Hart to Hart: Till Death Do Us Hart,1996,5.0\nMystery,Sleep Has Her House,2017,5.0\nMystery,The Capture of the Green River Killer,2008,5.0\nMystery,The Duel,1981,5.0\nRomance,Four Mothers,1941,5.0\nRomance,Love Is All,2007,5.0\nRomance,One Love,2003,5.0\nRomance,The Matchmaker's Playbook,2018,5.0\nRomance,Twisted Seduction,2010,5.0\nSci-Fi,Awaken,2013,5.0\nSci-Fi,Electric Nostalgia,2016,5.0\nSci-Fi,Night Key,1937,5.0\nSci-Fi,Say Nothing,2001,5.0\nSci-Fi,The Hexer,2001,5.0\nThriller,A Sister's Revenge,2013,5.0\nThriller,Clearcut,1991,5.0\nThriller,\"Love, Cheat & Steal\",1993,5.0\nThriller,The Capture of the Green River Killer,2008,5.0\nThriller,The Hunt for the Unicorn Killer,1999,5.0\nWar,Appointment in Bray,1971,5.0\nWar,Liberation: Direction of the Main Blow,1971,5.0\nWar,Raza,1942,5.0\nWar,The Last Hunter,1980,5.0\nWar,The Undefeated,2000,5.0\nWestern,Clearcut,1991,5.0\nWestern,Pony Express,1953,5.0\nWestern,Rio Diablo,1993,5.0\nWestern,The Last Hunt,1956,5.0\nWestern,War Arrow,1954,5.0\n"}]},"apps":[],"jobName":"paragraph_1585417174821_-278579911","id":"20200328-173934_821873549","dateCreated":"2020-03-28T17:39:34+0000","dateStarted":"2020-03-29T19:43:34+0000","dateFinished":"2020-03-29T19:43:36+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3674"},{"text":"%sh\n\nhdfs dfs -ls /user/zeppelin/sparkDF/output","user":"anonymous","dateUpdated":"2020-03-29T19:45:23+0000","config":{"colWidth":12,"fontSize":9,"enabled":false,"results":{},"editorSetting":{"language":"sh","editOnDblClick":false,"completionKey":"TAB","completionSupport":false},"editorMode":"ace/mode/sh"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1585430109253_-320722602","id":"20200328-211509_1872645727","dateCreated":"2020-03-28T21:15:09+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3675","dateFinished":"2020-03-29T19:44:12+0000","dateStarted":"2020-03-29T19:44:09+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"Found 2 items\n-rw-r--r--   2 zeppelin hadoop          0 2020-03-29 19:43 /user/zeppelin/sparkDF/output/_SUCCESS\n-rw-r--r--   2 zeppelin hadoop       3861 2020-03-29 19:43 /user/zeppelin/sparkDF/output/part-00000-507ccf45-e721-458c-944d-102c766f37f4-c000.csv\n"}]}}],"name":"Issoft/pyspark-topN-movies(Dataframe)","id":"2F43XB892","noteParams":{},"noteForms":{},"angularObjects":{"sh:shared_process":[],"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}